language: go
sudo: required
services:
- docker
env:
  global:
  - secure: C+RfWGKmX/IyL0R6fm1CLdlTttFgkfStjSadaiWzhlcM0ica9oPi/N3qCWPVXvsy2bE8G9rScDcUw5NFMi2KgvWy6/fNHHJ7aIfVXrUYQcsSViqDVzEdUlO5sLfODHrJx3sRQsHQpSBMDYXxZi0Zq/XlvHfygibIiA+McV+2Mkutz9RDK+BHxkBcCALDATXHrqlVmcBWQ2KT9NSDR9J7SmqUUi9k6ZUZg1eSHJXYjJHbzoaWVqgB9bW6wCgTvljL5hJ3XZcb53Y0obSUcYOtDSco0COvHfz//buX0N7Vnx/uW0yg56kRvMCd+rfkpj5rcJUOTf9AAS81ffLlwS8v+Q1OD4pUmnTo+UcSR+7ifO4mx2wGvMA3ytYMXf5VwymlNIWmpDu7orKE4XE6dAr9SpkknuZyhNZVwYIaahPKuMZ5CWNm5YNeE1azoR6EreB31XLdsPsEOkSBlh7a18wB7n7OYg2gEBdwt/uNKWoKn0QMTGLuYCQAR9IB/aIWbIn9cesMrZR0NjfrKLaGqCfhQn3zhjHSIn1s2fWSsTfc0BO/fWcZN2gDmB7XzKharZ3UNlPKcjathe/5gbRry2Nt9ajLIy4UOwCr4W2rjrfIK1YcV/38NvjSU/4etwwJmUPmfdNpCZK+NZxN7jeoyqSMqzN+fSUO+DrhBWmN9H2PQes=
  - secure: r8Y21TNCVYCEYFIPJd0bRhssEPP9LHT01/QHwX3qNYGw3tG+H8Z45il7FGc68E/uUXafK5/Vo4cqz3RJtK2VVGqWWo/Bx3ypMNEcHTOEL2dHOEC3rptTvmXMKgvT1SBoLLNiZZBDiRdR9Kr4E0QU62L6Qq6rOgN2VBwuD3HRRsRmcqCj3XWRASpNqEFiKbe1TLvgDspx27l83ixy8NhmpW35EEYNyR5VvtjX2NI2mAIb2HVfvPV0oOGBH3FuPtDc469tDbg1gWyNnBpBiOJU/S2GqlhY2/S9/FfUTPxUORnb2wZ/j6j8Vrakpl8WMyjU1QAeUyqWVoMFYyaa+nyLSrYdrXygp53Svowyqy0EjaOZlXRhZVCXSEHAZgvfGxg8gkAARxYHmngD3jQtwloKyNFWFP5sKOQ6JtkvGC5zKrXqo4rLaz7rz938v0badDYhJe7sVVZWBF4BChnlioKqwLkoKLsqlDJMVu7k/AKfIUEL7hJGFSj2UZQrmYwFURhjNAmek5fEpumiiYRpVxmFXPbYRglCTrLgSqmgopuJZoOBxiaNrA5n4QiOmXRivj4mmFjuhDP56BroGwPbK8UzaHE44oPA4MaFJVgZw/LwK6un9MNoq0FZgm4hsebMYZis0qoRah/TtnZY14m1kAwcyKNeON8md3Ok9j4pec1rzSc=
  - secure: jOlg7OPkBzjk4qcDI7idd/QnWsGSRTNRTLGa6dOuPfQCfKGZXEJGDbnw3z0UtVOYKsdlXaF1k1PqDlTxFGIo124a6VaVwEYsBfSW1bQVE5KvPVBH4j3rluVR+PC+sxXFrPUgfd0XYPe6KC/YFDP/wWlmlFmgE7eT990wyIqKqI2CEAJmcyzqVzN4vETkmbrYr9ulqgxPvqPO2ztj55sL2SX+WsgncDPlBLDapSzuKHdR+4MIKEf344pi99EAh0LrS+yFBnUFrhyPVD4WNgaQ6RB4gCUsYdGW1o6+XlReVljDW3QJXevy5vfX4LiXZQLQ0AUZJ3IBUvbzk4K1DkvYta+THnKOCIp09EMVjaSsO+VmtSNiA7xWeEav8PcEekDQo0QqarQxkkoAE1DWrfKHmr95QUAi/jl/Q9Ltxgl2jZ1aPj57aVA3hs0qOR7SsfZPSIkk5fIV7U5zniujVlKuG2eOnr6C5GL/S225ag300z9fuePEXUQe0UvJNZSlmuDC5PnG79Z8jQDlRdMqt0TQLcxYgtA3agNQjR9l/LXQrtTccpzi1DLzcYpeWMOLrqWX1u2l30CYO8qHyvl9veUIWXHLSC4Sau44KAoEN3kED3rMDUmm9gmAWWO9TnQt3CTBt9yLNPRP4jy+L0XI/UZUj3wfh2vKlVlgx+ZIIkzmnQk=
  - secure: EEEVSVa7ab+oHOQGepENrW5yrA8qJdDl5ugGeCpOmP4sFj0T4OSf8IAl/cIHs5/rA2MJpn4b8FP8EZKUXW0QU+y1/VhvJUwHz4YXiFp2R1jPDYq/GdosFwwpzgb03dTr0LNSznAEAlE2gtFbldi3phQBuYzhbkIh2pmpnGrCrqIUEYyCzUjr6GHi0XekmcnPoJFfFiUuqJDbk+4OzSi9XhPMjWwM4wEEFfc2SOSd2S2z+pa0meNxkc3dypWRjtfW5ReaqLA/Q/ThGgtAjdnwuGJbmFWXO9DpQj250s7RAEsHXdjCpzjWnm2dKNmCZC25Z2a14iEKVPQyXz+cAUHD/eJ8umAYT0U77tdcRvIMiy9WvLZFK8f5N6spF5VeWA3tmCuM5S6oaxZa5/EeI+NdjkTobh9jW5Fm26O6W0wQv9bCaM8KhdbuvNWFYy6a/WlyCOBz+xjf5QMSCY0PPE63qujVDu6Tw1k3Z6hZTAt6QfZxKuqo953+Oow8ZKOnK7sfTqfHQ9dGEKR6F3kwWXf/Fxq06OuF6lHRSJ7EPClfMT5PHNtY40EdHi+D2FrsuADI9zlvw3UpM3FDKu5SyPrJ8631T9Q5K7KExzg/+i9owW+L1FWTYKos8NJ3Mcpzw7mOQp4NPngJxNQoYbgebwJQmXg5qqnxny9NvKwBzbpFCMQ=
  - secure: kms2IuMo1PWcaFI77xeI43kxbT2sisvgD12vwHY9vmRyE8eQcBdG1t4ACqsKNOnKLsj341yvVdBJeFtFEqd+Hq7ax8+yMY5PaJdhIQ1blLAYWo7plv+HZ3C3joanKqCN6apIV+lcEjAuzUPh+c4WFj9KY0nx+1I+iGevSJMTdZg7+WgmiSX8qmM2IYdVKty0qLCCEMYyEDHgRAdlylKMh6KAoXlRidTX4bg1clT18WM7JDAKDmir3iscihw7bS5Epzk+sUnLtTrfjEgn+B5pU/0GBYNP/NMthogPMBo3HsnC50TmopDxv1ZXEQY4vtX6lc/AtnTR/uqo1KZM/f2wG5TmmexMil91eR/FXkMYezxo0G1yeAhwg2gFp1V/r2YOKb8xV3iIj8koLOR5CUfyNe8rkb2usaLMmklZ7CbV1CqptPvmZw+T6N7tIHhQcKleCrWgGK765wvjj1kUAUD1EUMMVIhOswpf5ZKWwgzraBNqEY49MgGRdNg3ZrT5v/lt4zBwOMz6zeDTMoTaWIdfdXEBN3z4uKaN2d3UWkcmu7cNkZAyQ8hC7nh+6G2AsPTiGyHl/II4e0sKpu2FH043iFeAv3URdPRaaMjcAqi8HDEOzyqyt7cIHjhmdNUoha5Gn9H7u+LAB3lRxcJ4Cg6lfaBKclI3CsUBKZf3jQ1ydNo=
before_install:
- openssl aes-256-cbc -K $encrypted_150e64d3bf53_key -iv $encrypted_150e64d3bf53_iv
  -in secrets.tar.enc -out operations/secrets.tar -d
- tar -xvf operations/secrets.tar -C operations
before_script:
- docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
script:
- make ci
before_deploy:
- nvm install node
- cd operations/scripts; npm install; cd ../../
deploy:
- provider: script
  script: "./operations/scripts/deploy.js --branch $TRAVIS_BRANCH --env testing"
  skip_cleanup: true
  on:
    all_branches: true
- provider: script
  script: "./operations/scripts/deploy.js --branch $TRAVIS_BRANCH --env staging"
  skip_cleanup: true
  on:
    branch: master
- provider: script
  script: "./operations/scripts/deploy.js --tag $TRAVIS_TAG --env production"
  skip_cleanup: true
  on:
    tags: true
notifications:
  slack:
    secure: QwSscYSX1d60cEGhLN9T6CwN4tds8rFT5tpG6oWxv+OIL62wmk6i7PMtmV86VP1o2hX9VTqFqCfP4FgZEdHZKGLHo5FIhXXdaXqY4vHFQvfIrrbD6FB3b2R7YkNiu+PrQpK6cf4nzvNqXst0yEzGDOghIoIbgc13YL+aYGPSdMF+TkfnfFPD3B+WaMRVqb+G8+6s3bNKni6SP1GDGEIDi1NOFC7dzDzhWmvD1ysKMpPuBZGQ6HTgXXjT1TfLArjyHmsWcbLschRFM5Ies+4Ukw8At/szYdjXD7VWRN9EXKLFmqUnkkTVLN7VZGN+SxNm5iiSMqgx5jxxqpmQLqAxNAxd2pLWGg4urCI6JlHztXDA6rWPJqcbrLRW+K5DUHJUCMV7TxwVgaryVIrnFYRX/WGO4B4KDhk1QcBBjdcgM+YCpvsXaM3j+EdTOSnqTm11BmlOGSYZZk82Cb9TCdhCKC52HxWRBZeG2LJ9VeHCcW2eqeOXoK1pLCz6y52QEzxrgolgcHksl9tlmjhVYH5dGGL99NNcuHLM7b8Ep7h8va3IRIWgbAzYV4IPGpPuhjn63B829piBnn0Ci/OMhyi+bgsZcDUFqeesw5zwqw4hR7FKinsCSWYnlhFy8BVtwvKay6A0LSE76w20J3xqtNh49liNU+4k7/dljTiUojAH1q8=
