language: go
sudo: required
services:
- docker
before_install:
- openssl aes-256-cbc -K $encrypted_150e64d3bf53_key -iv $encrypted_150e64d3bf53_iv
  -in secrets.tar.enc -out operations/secrets.tar -d
- tar -xvf operations/secrets.tar -C operations
before_script:
- docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
script:
- make ci
before_deploy:
- nvm install node
- cd operations/scripts; npm install; cd ../../
deploy:
- provider: script
  script: "./operations/scripts/deploy.js --branch $TRAVIS_BRANCH --env testing"
  skip_cleanup: true
  on:
    all_branches: true
- provider: script
  script: "./operations/scripts/deploy.js --branch $TRAVIS_BRANCH --env staging"
  skip_cleanup: true
  on:
    branch: master
- provider: script
  script: "./operations/scripts/deploy.js --tag $TRAVIS_TAG --env production"
  skip_cleanup: true
  on:
    tags: true
notifications:
  slack:
    secure: NTn5LCfWtig6PKkTagAUHo/zycvdPqI8QT/21K46L//UL48ZawIYUbEHwz1cvEQl3kgUj4Cq7DudzMLNm+y5JLCbSaZSrdVLOXmp89o/2o1nNHNhd1+ewhc+94Ue9FnAIcBeBKcbA5ZLZ2o/rQfp5bzBLuVkug9EB/UW402G+87FLxgdvMqTbu7oHl4X5LJxRulduWo/UCrBvSqDB2IbBMz3dSSnPn5sn5Xtcch0v25PQV/rKcG0VZs+Y6tfmkwvi7bj5XlXfD9uFjYn3C4+u4s0gubYZuotZMKh/mo5o1FoJibAZKsLcOEKl6JGisHWtT4TtU13btF7mrWmihyjqBgCJrXBT3lX+5khBAT2QHpYjJuoOsfsPL0MawUWGMYUdaOIyHw9Qp+TsSezMaf/Fai69Hh0AJ8ziDERu9eIBRTX49twdtMuUFNF8WNKtbUWGrM0/sg3QZCB1/1zcSYU2cTm6Kn+wyYIHX7LD+lEl9VhhDGuTjSCJnc2AiivxtL7GjEBUo9p0VxCFAmhI38S3AawzogTqj5PZ8cyZh2KLrBHppnBBI5LqkF8Y+F0oV1DbagJ21fe1X0j+lKasxyUgSaGROv8mIUD23GlnGk8GOYYU1z8qqRRUXkWlIf1RcnRVy/gEri8K8viG/WVvxIvQs513hEY2L8pH7LfvNxTJlE=
env:
  global:
  - secure: FaW9bDlX8SpkOY8oDQLcYdIeSLwbQl5zrouuJMKfGbffQDSPOXINSYWgCACGJhvnxFAiknPPUHDEG40ERl1kePnEhwmHf8HJ4jDfgiwUhAJZJ0RCRGoLLs52dq1x0jBxp8kG2uDPJNzSYDgo9QgpIDI3fLS2RlCGqZh22o268AJI4IatLu8luokWKETlxQ5X29fdyXK31Jc6oUuygDiL5ZecmQuj+cJWFWaAP7pk5eVCDSzARTTiSssZ24+n0yat7fmkv7hlXycxzqsHLXyM4+3TAeqS6kGSaZgN/S9Ugy6snlIAJ8zQoY5Z4tr8JRiH6E4zv07l3jaR5NwOgEuRdkhA4m8QUFmyMQ219B2c0OqLL/MLM2iGECVDZqYq6HdPHuA0u4ldEMJg62OI5L31lrgRdRjrOozZJtLezv6O3GOovtDEalJ3bmB/31lwe24bPz7clElTDR4kybsT9GXJwwLW7fNo0c1vfPZWeJZN6XpY5VS6hupkOVOVSxjewzqzLgmHwyXnvriF+/pub8EtuBS6aM3iyKDSfpyRSL6AomHkynupNf21EnfxW79ziHWOMhPnTe+wT4/Dii0OGJrMdIgtsWXcwnL7PRyRC+AaeJZNMQ7OvE5L8YWkHI9asOs5qyr+eJQP05HlP/HC5jSn/b+WzfQ7NGsSu0CQaBs6rbw=
  - secure: qoV3EJqZA2UBkLRLEECOsRblR/S8B238lbbyVVkXXM27Bf0NIxn7FYpHRvXzTHSsIFLHEvsFKbfV9PDzNVipYxAio/mKIUnPX3Kd3CzHCGLr7rrtvx9rUyAj0l8mbkN/XJcNVWlTjvhqxarJRo8AJPtnWj9zsXnSTyDNdcBkxKd2syf7JTkWyBgGX4KlSuaZ5ILynpu7w26rwnC5thxh+UXCoUtukYlBvKh8P90aF1MkNH8WdNygZmPSAFHwkCgwlUaRSWeSMwpeDYinOUb/PL7R4nAgTtTKcc0lmZcA1VUcvTgbzbi01xd2tBy3GdDzWPIaz5Q8ZSQxg5+GFf7cSP52Ewck1ByMwixM0B34q+HOgehebVgFPP8h670EsPEVaaYeQchoOrn4h91Glkrt52yy3xnPO4rS0IvUO6C2FJIUBMLvZPoZKschNVtdfadMw80Q7iAKUj6HAu5htq7LpvroZr1zv/cLIJ6Fmnwe27C5sn0m49KCxUNSRop1U2vTPmXpD3XBKVcAUwK7lhYnvydH9Fz4wDw24G848QQCsAGGt3CgwqwL4IUMT6+ZGA+mTwthdxbQ8nJnqgJDiZ1//OFKztqopuWap2AJrV17LDQaTnTWn3PuEmXqoWXHh5x2ligQwyOO6/LAjGubDJQyc9CnsJx8vlceTegJ3Y0YwyQ=
  - secure: kCAqMGbuaiPsNQUWy1vVseCPrlNKPi7HhyUzHCDzJi68H/9Vklzfq+Mc6qVXsA5O9ecV9g1O51CfpTRq8nN/zFaZPfBrnfFeTR5+1sTMBhT1pydeOgOgRA1w4wT0SMRE/oLdbuX74tJw/BUdSKPJnPmw5vVRVV8HpNeYsH2N9zr+1637vLKUOE419dQxdsVzcLDshkYgTyb1jqn3WD+NJNChmTG96qpz880fYQbiIddGDZdrDF8Ic48+uLC22rIz24TPHLlmwyMAV+aHQIvr6+GWPO++W6IOWDx+efsZZHXAAJ+wGVqGukxUx53HvhQK0bNcQOlt1WpEJ5FEJde+OyHmc00uFKXKU+am4XOCvMnBEhDoQRzZkyh7iAMeBGSA8prHgFUvGd9hMsQLCbLyJqIIBYC9jo4xLj0lqZ5f+dm+sMucHNJfLiZlZm99Wih90cXUhOCG2BtlDRVm/77ymAj9mjm3gp3KzXVICWFIRp9H+Z8gvWofwdNx8rRAKn1aUN619SqZbg7GWbLD64EkQwix28TJpRf+LIR37vnRFC26FW4kpazcmwSRoXRx455HnxBbyNgmN3uj8K5e5LieneEwcNZG7oU2RMQvj1zQCV1sA7I7hiGFyX/xgh5XbHQKpx9PIRBxflRJhmsG0nVNxgvBTvZoeUnc/Es3yP3QHuE=
